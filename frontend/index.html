<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>NhoyHub</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          screens: {
            'xs': '475px',
          },
        }
      }
    }
  </script>
</head>
<body class="bg-gray-50 min-h-screen">
<header class="bg-white border-b sticky top-0 z-20">
  <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
    <h1 class="font-bold text-xl">Swift DIV</h1>
    
    <nav class="hidden sm:flex text-sm space-x-4 items-center">
      <a href="place_order.html" class="text-green-600 font-bold hover:underline">Place New Order</a>
      <a href="login.html" class="text-indigo-600 hover:underline">Admin Login</a>
    </nav>

    <button id="menu-toggle" class="sm:hidden p-2 text-gray-600 focus:outline-none">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
    </button>
  </div>
  
  <div id="mobile-menu" 
       class="fixed top-0 right-0 h-full w-64 bg-white shadow-xl transform translate-x-full transition-transform duration-300 ease-in-out sm:hidden z-30">
    
    <div class="flex justify-between items-center p-4 border-b">
        <h2 class="text-lg font-semibold">Menu</h2>
        <button id="close-menu" class="text-gray-600 focus:outline-none">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>
    </div>

    <nav class="p-4 space-y-2">
      <a href="place_order.html" class="block py-3 text-green-600 font-bold border-b hover:bg-gray-100 px-2 rounded-md">Place New Order</a>
      <a href="login.html" class="block py-3 text-indigo-600 border-b hover:bg-gray-100 px-2 rounded-md">Admin Login</a>
    </nav>
  </div>
</header>

<main class="max-w-6xl mx-auto px-4 py-8 space-y-6">
  
  <div class="space-y-3 sm:space-y-0 sm:flex sm:flex-row sm:gap-3 sm:items-center sm:justify-between" id="filter-section">
    <div class="flex flex-col sm:flex-row gap-2 w-full sm:w-auto">
      <input id="q" class="border rounded px-3 py-2 w-full sm:w-60" placeholder="Search name or UDID">
      <select id="status" class="border rounded px-3 py-2 w-full sm:w-40">
        <option value="">All Statuses</option>
        <option value="pending">Pending</option>
        <option value="approved">Approved</option>
        <option value="rejected">Rejected</option>
      </select>
      <button id="btnSearch" class="px-4 py-2 rounded bg-indigo-600 text-white w-full sm:w-auto">Search</button>
    </div>
    <div id="meta" class="text-sm text-gray-600 text-center sm:text-right"></div>
  </div>

  <div id="grid" class="grid gap-4 xs:grid-cols-2 md:grid-cols-3 lg:grid-cols-4"></div>

  <div class="flex items-center justify-center gap-2">
    <button id="prev" class="px-3 py-1 border rounded disabled:opacity-50">Prev</button>
    <span id="pageInfo" class="text-sm"></span>
    <button id="next" class="px-3 py-1 border rounded disabled:opacity-50">Next</button>
  </div>
</main>

<script>
// Mobile Menu Toggle Logic
const menuToggle = document.getElementById('menu-toggle');
const mobileMenu = document.getElementById('mobile-menu');
const closeMenu = document.getElementById('close-menu');
const body = document.body;

function openMenu() {
    mobileMenu.classList.remove('translate-x-full');
    mobileMenu.classList.add('translate-x-0');
    body.classList.add('overflow-hidden');
}

function closeMenuHandler() {
    mobileMenu.classList.remove('translate-x-0');
    mobileMenu.classList.add('translate-x-full');
    body.classList.remove('overflow-hidden');
}

menuToggle.onclick = openMenu;
closeMenu.onclick = closeMenuHandler;


const API = "http://127.0.0.1:8000"; // <-- Deployment Placeholder URL
let page = 1, pageSize = 12, lastTotal = 0;

async function load() {
  const q = document.getElementById('q').value.trim();
  const status = document.getElementById('status').value;
  const url = new URL(API + "/orders");
  url.searchParams.set("page", page);
  url.searchParams.set("page_size", pageSize);
  url.searchParams.set("sort", "-id");
  if (q) url.searchParams.set("q", q);
  if (status) url.searchParams.set("status", status);

  try {
    const res = await fetch(url);
    const data = await res.json();
    lastTotal = data.total;

    document.getElementById('meta').textContent = `${data.total} orders total`;
    document.getElementById('pageInfo').textContent = `Page ${data.page} of ${Math.ceil(data.total / pageSize) || 1}`;

    const grid = document.getElementById('grid');
    grid.innerHTML = "";
    if (data.items.length === 0) {
      grid.innerHTML = `<div class="text-gray-500 col-span-full text-center py-10">No orders found matching the criteria.</div>`;
      return;
    }
    data.items.forEach(o => {
      // 1. Map DB status 'rejected' to display status 'backlist' for the label
      const displayStatus = o.status === 'rejected' ? 'backlist' : o.status;
      
      // 2. Define colors based on DB status (rejected = red)
      const statusColor = o.status==='approved'?'border-green-500 bg-green-50 text-green-700':'' +
                          (o.status==='pending'?'border-yellow-500 bg-yellow-50 text-yellow-700':'' )+
                          (o.status==='rejected'?'border-red-500 bg-red-50 text-red-700':'');


      grid.innerHTML += `
        <article class="bg-white border rounded-xl overflow-hidden shadow-sm hover:shadow-md transition">
          <img src="${o.image_url}" class="w-full h-40 object-cover" alt="Order Image">
          <div class="p-4 text-sm space-y-1">
            <div class="font-medium">${o.name}</div>
            
            <div class="font-mono break-all text-gray-700 text-xs">UDID: ${o.udid}</div> 
            
            <div class="text-xs">Status:
              <span class="px-2 py-0.5 rounded-full border text-xs ${statusColor}">${displayStatus}</span>
            </div>
            
            <div class="pt-2">
                <a href="details.html?id=${o.id}" class="text-indigo-600 font-medium text-xs hover:underline">
                    View Details â†’
                </a>
            </div>
            
            <div class="text-xs text-gray-500">${new Date(o.created_at).toLocaleString()}</div>
          </div>
        </article>`;
    });
  } catch (error) {
    document.getElementById('grid').innerHTML = '<div class="text-red-600 col-span-full text-center py-10">Error loading orders. Is the API running?</div>';
  }
}

document.getElementById('btnSearch').onclick = () => { page = 1; load(); };
document.getElementById('prev').onclick = () => { if (page>1){ page--; load();} };
document.getElementById('next').onclick = () => {
  const maxPage = Math.ceil(lastTotal / pageSize) || 1;
  if (page < maxPage){ page++; load(); }
};
load();
</script>
</body>
</html>